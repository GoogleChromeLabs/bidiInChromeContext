/**
 * Copyright 2024 Google LLC.
 * Copyright (c) Microsoft Corporation.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// List the tests with the `chromium-bidi-2023` label.
// https://github.com/web-platform-tests/wpt-metadata/pull/5725
const RELEVANT_TESTS = new Set([
  '/webdriver/tests/bidi/browsing_context/activate/activate.py',
  '/webdriver/tests/bidi/browsing_context/activate/invalid.py',
  '/webdriver/tests/bidi/browsing_context/capture_screenshot/capture_screenshot.py',
  '/webdriver/tests/bidi/browsing_context/capture_screenshot/clip.py',
  '/webdriver/tests/bidi/browsing_context/capture_screenshot/format.py',
  '/webdriver/tests/bidi/browsing_context/capture_screenshot/frame.py',
  '/webdriver/tests/bidi/browsing_context/capture_screenshot/invalid.py',
  '/webdriver/tests/bidi/browsing_context/capture_screenshot/origin.py',
  '/webdriver/tests/bidi/browsing_context/classic_interop/window_handle.py',
  '/webdriver/tests/bidi/browsing_context/close/close.py',
  '/webdriver/tests/bidi/browsing_context/close/invalid.py',
  '/webdriver/tests/bidi/browsing_context/context_created/context_created.py',
  '/webdriver/tests/bidi/browsing_context/context_destroyed/context_destroyed.py',
  '/webdriver/tests/bidi/browsing_context/create/background.py',
  '/webdriver/tests/bidi/browsing_context/create/invalid.py',
  '/webdriver/tests/bidi/browsing_context/create/reference_context.py',
  '/webdriver/tests/bidi/browsing_context/create/type.py',
  '/webdriver/tests/bidi/browsing_context/dom_content_loaded/dom_content_loaded.py',
  '/webdriver/tests/bidi/browsing_context/fragment_navigated/fragment_navigated.py',
  '/webdriver/tests/bidi/browsing_context/fragment_navigated/history_api.py',
  '/webdriver/tests/bidi/browsing_context/get_tree/frames.py',
  '/webdriver/tests/bidi/browsing_context/get_tree/invalid.py',
  '/webdriver/tests/bidi/browsing_context/get_tree/max_depth.py',
  '/webdriver/tests/bidi/browsing_context/get_tree/root.py',
  '/webdriver/tests/bidi/browsing_context/handle_user_prompt/handle_user_prompt.py',
  '/webdriver/tests/bidi/browsing_context/handle_user_prompt/invalid.py',
  '/webdriver/tests/bidi/browsing_context/load/load.py',
  '/webdriver/tests/bidi/browsing_context/locate_nodes/context.py',
  '/webdriver/tests/bidi/browsing_context/locate_nodes/invalid.py',
  '/webdriver/tests/bidi/browsing_context/locate_nodes/locator.py',
  '/webdriver/tests/bidi/browsing_context/locate_nodes/max_node_count.py',
  '/webdriver/tests/bidi/browsing_context/locate_nodes/ownership.py',
  '/webdriver/tests/bidi/browsing_context/locate_nodes/sandbox.py',
  '/webdriver/tests/bidi/browsing_context/locate_nodes/serialization_options.py',
  '/webdriver/tests/bidi/browsing_context/locate_nodes/start_nodes.py',
  '/webdriver/tests/bidi/browsing_context/navigate/about_blank.py',
  '/webdriver/tests/bidi/browsing_context/navigate/data_url.py',
  '/webdriver/tests/bidi/browsing_context/navigate/error.py',
  '/webdriver/tests/bidi/browsing_context/navigate/frame.py',
  '/webdriver/tests/bidi/browsing_context/navigate/hash.py',
  '/webdriver/tests/bidi/browsing_context/navigate/image.py',
  '/webdriver/tests/bidi/browsing_context/navigate/invalid.py',
  '/webdriver/tests/bidi/browsing_context/navigate/navigate.py',
  '/webdriver/tests/bidi/browsing_context/navigate/wait.py',
  '/webdriver/tests/bidi/browsing_context/navigation_started/navigation_started.py',
  '/webdriver/tests/bidi/browsing_context/print/background.py',
  '/webdriver/tests/bidi/browsing_context/print/context.py',
  '/webdriver/tests/bidi/browsing_context/print/invalid.py',
  '/webdriver/tests/bidi/browsing_context/print/margin.py',
  '/webdriver/tests/bidi/browsing_context/print/orientation.py',
  '/webdriver/tests/bidi/browsing_context/print/page_ranges.py',
  '/webdriver/tests/bidi/browsing_context/print/page.py',
  '/webdriver/tests/bidi/browsing_context/print/scale.py',
  '/webdriver/tests/bidi/browsing_context/print/shrink_to_fit.py',
  '/webdriver/tests/bidi/browsing_context/reload/frame.py',
  '/webdriver/tests/bidi/browsing_context/reload/invalid.py',
  '/webdriver/tests/bidi/browsing_context/reload/reload.py',
  '/webdriver/tests/bidi/browsing_context/reload/wait.py',
  '/webdriver/tests/bidi/browsing_context/set_viewport/device_pixel_ratio.py',
  '/webdriver/tests/bidi/browsing_context/set_viewport/invalid.py',
  '/webdriver/tests/bidi/browsing_context/set_viewport/viewport.py',
  '/webdriver/tests/bidi/browsing_context/traverse_history/context.py',
  '/webdriver/tests/bidi/browsing_context/traverse_history/delta.py',
  '/webdriver/tests/bidi/browsing_context/traverse_history/invalid.py',
  '/webdriver/tests/bidi/browsing_context/user_prompt_closed/user_prompt_closed.py',
  '/webdriver/tests/bidi/browsing_context/user_prompt_opened/user_prompt_opened.py',
  '/webdriver/tests/bidi/errors/errors.py',
  '/webdriver/tests/bidi/input/perform_actions/invalid.py',
  '/webdriver/tests/bidi/input/perform_actions/key_events.py',
  '/webdriver/tests/bidi/input/perform_actions/key_modifier.py',
  '/webdriver/tests/bidi/input/perform_actions/key.py',
  '/webdriver/tests/bidi/input/perform_actions/pointer_mouse_drag.py',
  '/webdriver/tests/bidi/input/perform_actions/pointer_mouse_modifier.py',
  '/webdriver/tests/bidi/input/perform_actions/pointer_mouse_multiclick.py',
  '/webdriver/tests/bidi/input/perform_actions/pointer_mouse.py',
  '/webdriver/tests/bidi/input/perform_actions/pointer_origin.py',
  '/webdriver/tests/bidi/input/perform_actions/pointer_pen.py',
  '/webdriver/tests/bidi/input/perform_actions/pointer_touch.py',
  '/webdriver/tests/bidi/input/perform_actions/pointer.py',
  '/webdriver/tests/bidi/input/perform_actions/wheel_origin.py',
  '/webdriver/tests/bidi/input/perform_actions/wheel.py',
  '/webdriver/tests/bidi/input/release_actions/context.py',
  '/webdriver/tests/bidi/input/release_actions/invalid.py',
  '/webdriver/tests/bidi/input/release_actions/release.py',
  '/webdriver/tests/bidi/input/release_actions/sequence.py',
  '/webdriver/tests/bidi/log/entry_added/console_args.py',
  '/webdriver/tests/bidi/log/entry_added/console.py',
  '/webdriver/tests/bidi/log/entry_added/event_buffer.py',
  '/webdriver/tests/bidi/log/entry_added/javascript.py',
  '/webdriver/tests/bidi/log/entry_added/realm.py',
  '/webdriver/tests/bidi/log/entry_added/stacktrace.py',
  '/webdriver/tests/bidi/log/entry_added/subscription.py',
  '/webdriver/tests/bidi/network/add_intercept/add_intercept.py',
  '/webdriver/tests/bidi/network/add_intercept/invalid.py',
  '/webdriver/tests/bidi/network/add_intercept/phase_auth_required.py',
  '/webdriver/tests/bidi/network/add_intercept/phases.py',
  '/webdriver/tests/bidi/network/add_intercept/url_patterns.py',
  '/webdriver/tests/bidi/network/auth_required/auth_required.py',
  '/webdriver/tests/bidi/network/auth_required/unsubscribe.py',
  '/webdriver/tests/bidi/network/before_request_sent/before_request_sent.py',
  '/webdriver/tests/bidi/network/combined/network_events.py',
  '/webdriver/tests/bidi/network/continue_request/invalid.py',
  '/webdriver/tests/bidi/network/continue_response/invalid.py',
  '/webdriver/tests/bidi/network/continue_with_auth/action.py',
  '/webdriver/tests/bidi/network/continue_with_auth/invalid.py',
  '/webdriver/tests/bidi/network/fail_request/invalid.py',
  '/webdriver/tests/bidi/network/provide_response/invalid.py',
  '/webdriver/tests/bidi/network/remove_intercept/invalid.py',
  '/webdriver/tests/bidi/network/remove_intercept/remove_intercept.py',
  '/webdriver/tests/bidi/network/response_completed/response_completed_cached.py',
  '/webdriver/tests/bidi/network/response_completed/response_completed_status.py',
  '/webdriver/tests/bidi/network/response_completed/response_completed.py',
  '/webdriver/tests/bidi/network/response_started/response_started_cached.py',
  '/webdriver/tests/bidi/network/response_started/response_started.py',
  '/webdriver/tests/bidi/script/add_preload_script/add_preload_script.py',
  '/webdriver/tests/bidi/script/add_preload_script/arguments.py',
  '/webdriver/tests/bidi/script/add_preload_script/invalid.py',
  '/webdriver/tests/bidi/script/add_preload_script/sandbox.py',
  '/webdriver/tests/bidi/script/call_function/arguments.py',
  '/webdriver/tests/bidi/script/call_function/await_promise.py',
  '/webdriver/tests/bidi/script/call_function/channel.py',
  '/webdriver/tests/bidi/script/call_function/exception_details_await_promise.py',
  '/webdriver/tests/bidi/script/call_function/exception_details.py',
  '/webdriver/tests/bidi/script/call_function/function_declaration.py',
  '/webdriver/tests/bidi/script/call_function/internal_id.py',
  '/webdriver/tests/bidi/script/call_function/invalid_tentative.py',
  '/webdriver/tests/bidi/script/call_function/invalid.py',
  '/webdriver/tests/bidi/script/call_function/primitive_values.py',
  '/webdriver/tests/bidi/script/call_function/realm.py',
  '/webdriver/tests/bidi/script/call_function/remote_reference.py',
  '/webdriver/tests/bidi/script/call_function/remote_values.py',
  '/webdriver/tests/bidi/script/call_function/result_node.py',
  '/webdriver/tests/bidi/script/call_function/result_ownership.py',
  '/webdriver/tests/bidi/script/call_function/sandbox.py',
  '/webdriver/tests/bidi/script/call_function/serialization_options.py',
  '/webdriver/tests/bidi/script/call_function/strict_mode.py',
  '/webdriver/tests/bidi/script/call_function/this.py',
  '/webdriver/tests/bidi/script/call_function/user_activation.py',
  '/webdriver/tests/bidi/script/classic_interop/node_shared_id.py',
  '/webdriver/tests/bidi/script/classic_interop/window_reference.py',
  '/webdriver/tests/bidi/script/disown/handles.py',
  '/webdriver/tests/bidi/script/disown/invalid_tentative.py',
  '/webdriver/tests/bidi/script/disown/invalid.py',
  '/webdriver/tests/bidi/script/disown/target.py',
  '/webdriver/tests/bidi/script/evaluate/await_promise.py',
  '/webdriver/tests/bidi/script/evaluate/evaluate.py',
  '/webdriver/tests/bidi/script/evaluate/exception_details_await_promise.py',
  '/webdriver/tests/bidi/script/evaluate/exception_details.py',
  '/webdriver/tests/bidi/script/evaluate/internal_id.py',
  '/webdriver/tests/bidi/script/evaluate/invalid_tentative.py',
  '/webdriver/tests/bidi/script/evaluate/invalid.py',
  '/webdriver/tests/bidi/script/evaluate/primitive_values.py',
  '/webdriver/tests/bidi/script/evaluate/remote_values.py',
  '/webdriver/tests/bidi/script/evaluate/result_node.py',
  '/webdriver/tests/bidi/script/evaluate/result_ownership.py',
  '/webdriver/tests/bidi/script/evaluate/sandbox.py',
  '/webdriver/tests/bidi/script/evaluate/strict_mode.py',
  '/webdriver/tests/bidi/script/evaluate/user_activation.py',
  '/webdriver/tests/bidi/script/get_realms/context.py',
  '/webdriver/tests/bidi/script/get_realms/get_realms.py',
  '/webdriver/tests/bidi/script/get_realms/invalid.py',
  '/webdriver/tests/bidi/script/get_realms/sandbox.py',
  '/webdriver/tests/bidi/script/get_realms/type.py',
  '/webdriver/tests/bidi/script/message/message.py',
  '/webdriver/tests/bidi/script/realm_created/realm_created.py',
  '/webdriver/tests/bidi/script/realm_destroyed/realm_destroyed.py',
  '/webdriver/tests/bidi/script/remove_preload_script/invalid.py',
  '/webdriver/tests/bidi/script/remove_preload_script/remove_preload_script.py',
  '/webdriver/tests/bidi/script/remove_preload_script/sandbox.py',
  '/webdriver/tests/bidi/session/new/connect.py',
  '/webdriver/tests/bidi/session/status/status.py',
  '/webdriver/tests/bidi/session/subscribe/contexts.py',
  '/webdriver/tests/bidi/session/subscribe/events.py',
  '/webdriver/tests/bidi/session/subscribe/invalid.py',
  '/webdriver/tests/bidi/session/unsubscribe/contexts.py',
  '/webdriver/tests/bidi/session/unsubscribe/events.py',
  '/webdriver/tests/bidi/session/unsubscribe/invalid.py',
]);

export const apply2023Filter = (reportData) => {
  const filteredResults = [];
  for (const result of reportData.results) {
    if (RELEVANT_TESTS.has(result.test)) {
      filteredResults.push(result);
    }
  }
  const filteredReportData = structuredClone(reportData);
  filteredReportData.results = filteredResults;
  filteredReportData.isFiltered = true;
  // The status at 2023-12-31 gives us a baseline to compare against
  // to track our progress during 2024.
  filteredReportData.baseline = {
    date: '2023-12-31',
    passing: 2456,
    // TODO: Why does https://wpt.fyi/results/webdriver/tests/bidi?sha=2a639a9fe4cdefd4ecd124a3f30caf631150eea5&label=master&max-count=1&q=label%3Achromium-bidi-2023 show a greater number of total subtests (2894)?
    total: 2807,
  };
  return filteredReportData;
};
